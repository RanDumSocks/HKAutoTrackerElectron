<!DOCTYPE html>
<html id="main">
   <head>
      <meta charset="UTF-8" />
      <title>Nearest Tracker</title>
      <script src="jquery.min.js"></script>
      <script src="mermaid.min.js"></script>
      <script>
         mermaid.initialize({
            startOnLoad: false,
            theme: "dark",
         })

         const updateGraph = () => {
            var prevScroll = { x: window.scrollX, y: window.scrollY }
            var graphDefTransition = document.getElementById("mermaidGraphTransition").innerText
            var graphDefCheck = document.getElementById("mermaidGraphCheck").innerText
            var graphDefBench = document.getElementById("mermaidGraphBench").innerText
            try {
               var graph = mermaid.mermaidAPI.render("mermaidOutSVGTransition", graphDefTransition, (svgCode, bindFunction) => {
                  document.getElementById("mermaidOutTransition").innerHTML = svgCode
                  var svg = document.getElementById("mermaidOutSVGTransition")
                  svg.style.width = getComputedStyle(svg).maxWidth
               })
               var graph = mermaid.mermaidAPI.render("mermaidOutSVGCheck", graphDefCheck, (svgCode, bindFunction) => {
                  document.getElementById("mermaidOutCheck").innerHTML = svgCode
                  var svg = document.getElementById("mermaidOutSVGCheck")
                  svg.style.width = getComputedStyle(svg).maxWidth
               })
               var graph = mermaid.mermaidAPI.render("mermaidOutSVGBench", graphDefBench, (svgCode, bindFunction) => {
                  document.getElementById("mermaidOutBench").innerHTML = svgCode
                  var svg = document.getElementById("mermaidOutSVGBench")
                  svg.style.width = getComputedStyle(svg).maxWidth
               })
            } catch (err) {
               console.log(err)
            }
            window.scrollTo(prevScroll.x, prevScroll.y)
         }

         window.addEventListener("DOMContentLoaded", () => {
            updateGraph()
            new MutationObserver((mutationsList, observer) => {
               updateGraph()
            }).observe(document.getElementById("mermaidGraph"), { attributes: true, childList: true, subtree: true })
         })
      </script>
      <script>
         var zoom = 1
         window.addEventListener("wheel", (event) => {
            zoom -= event.deltaY / 1500
            zoom = Math.min(Math.max(zoom, 0.2), 2)
            document.body.style.zoom = zoom
         })
      </script>
      <script>
         window.addEventListener("DOMContentLoaded", () => {
            const ele = document.getElementById("main")
            ele.style.cursor = "grab"
            let pos = { top: 0, left: 0, x: 0, y: 0 }

            const mouseDownHandler = (e) => {
               ele.style.cursor = "grabbing"
               ele.style.userSelect = "none"
               pos = {
                  left: window.scrollX,
                  top: window.scrollY,
                  x: e.clientX,
                  y: e.clientY,
               }
               document.addEventListener("mousemove", mouseMoveHandler)
               document.addEventListener("mouseup", mouseUpHandler)
            }

            const mouseMoveHandler = (e) => {
               const dx = e.clientX - pos.x
               const dy = e.clientY - pos.y
               window.scrollTo(pos.left - dx, pos.top - dy)
            }

            const mouseUpHandler = () => {
               ele.style.cursor = "grab"
               ele.style.removeProperty("usser-select")
               document.removeEventListener("mousemove", mouseMoveHandler)
               document.removeEventListener("mouseup", mouseUpHandler)
            }

            window.addEventListener("mousedown", mouseDownHandler)
         })
      </script>
      <style>
         @font-face {
            font-family: Ubuntu;
            src: url("Ubuntu-Bold.ttf");
         }
         body {
            overflow: hidden;
            height: 100%;
            background-color: #202020;
         }
         h2 {
            font-family: Ubuntu;
            color: floralwhite;
         }
         .node {
            cursor: default;
         }
         .node rect {
            fill: #000000 !important;
            stroke: #333 !important;
         }
         .edge-thickness-normal:hover {
            stroke-width: 8px !important;
            stroke: green !important;
            cursor: help;
         }
         .mermaidGraph {
            display: none;
         }
         .edgeLabel {
            background-color: #202020 !important;
         }
      </style>
   </head>
   <body>
      <div class="mermaidGraph" id="mermaidGraph"></div>
      <div id="nTransition">
         <h2>Nearest Transition</h2>
         <div class="mermaidGraph" id="mermaidGraphTransition"></div>
         <div id="mermaidOutTransition"></div>
      </div>
      <div id="nCheck">
         <h2>Nearest Check</h2>
         <div class="mermaidGraph" id="mermaidGraphCheck"></div>
         <div id="mermaidOutCheck"></div>
      </div>
      <div id="nBench">
         <h2>Nearest Bench</h2>
         <div class="mermaidGraph" id="mermaidGraphBench"></div>
         <div id="mermaidOutBench"></div>
      </div>
   </body>
</html>
